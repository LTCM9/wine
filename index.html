<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wiles Family Wine List</title>
  <style>
    /* GLOBAL & TYPOGRAPHY */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: Georgia, serif;
      color: #333;
      line-height: 1.4;
      display: flex;
      min-height: 100vh;
    }
    a { color: #000080; text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* SIDEBAR (Jump-To Nav + Filters) */
    #sidebar {
      flex: 0 0 220px;
      padding: 1rem;
      background: #f0f4fa;
      border-right: 1px solid #777;
      position: sticky; top: 0; align-self: flex-start;
      height: 100vh;
      overflow-y: auto;
    }
    #sidebar h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #777;
    }
    /* Fancy inputs and selects */
    #sidebar input,
    #sidebar select {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.5rem;
      font-size: 0.9rem;
      color: #777;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #fff;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    #sidebar input::placeholder {
      color: #777;
    }
    #sidebar input:focus,
    #sidebar select:focus {
      border-color: #000080;
      outline: none;
      box-shadow: 0 0 5px rgba(0,0,128,0.3);
    }
    /* Fancy reset button */
    #sidebar button {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.6rem;
      font-size: 0.9rem;
      color: #fff;
      background: #000080;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.2s, box-shadow 0.2s;
    }
    #sidebar button:hover {
      background: #3333aa;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }

    /* MAIN CONTENT */
    #main {
      flex: 1; padding: 2rem;
    }
    h1 {
      margin-top: 0;
      color: #777;
    }
    h2 {
      font-size: 1.8rem;
      margin-top: 2rem;
      border-bottom: 2px solid #777;
      padding-bottom: 0.3rem;
    }
    section[id^="type-Red"] h2 { color: red; }
    section[id^="type-White"] h2 { color: gold; }
    h3 {
      font-size: 1.4rem;
      margin-top: 1.5rem;
      color: #555;
    }
    h4 {
      font-size: 1.1rem;
      margin-top: 1rem;
      color: #777;
    }
    .wine-list {
      list-style: none;
      padding-left: 0;
      margin: 0.5rem 0 1rem 0;
    }
    .wine-list li {
      margin: 0.2rem 0;
    }

    /* RESPONSIVE: collapse sidebar on narrow */
    @media (max-width: 768px) {
      body { flex-direction: column; }
      #sidebar {
        position: relative;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #777;
      }
    }
  </style>
</head>
<body>
  <aside id="sidebar">
    <h2>Jump to Type</h2>
    <ul id="nav-list"></ul>
    <h2>Search & Filter</h2>
    <input type="text" id="search" placeholder="Searchâ€¦">
    <select id="filter-country">
      <option value="All">All Countries</option>
    </select>
    <select id="filter-varietal">
      <option value="All">All Varietals</option>
    </select>
    <button id="reset">Reset Filters</button>
  </aside>
  <main id="main">
    <h1>Wiles Family Wine List</h1>
    <div id="wine-list"></div>
  </main>
  <script>
    let wines = [];
    const uniqSorted = arr => [...new Set(arr)].sort();

    fetch('wine-data.json')
      .then(r => r.json())
      .then(data => {
        wines = data;
        buildFilters();
        buildNav();
        renderList();
        document.getElementById('search').addEventListener('input', renderList);
        document.getElementById('filter-country').addEventListener('change', renderList);
        document.getElementById('filter-varietal').addEventListener('change', renderList);
        document.getElementById('reset').addEventListener('click', () => {
          document.getElementById('search').value = '';
          document.getElementById('filter-country').value = 'All';
          document.getElementById('filter-varietal').value = 'All';
          renderList();
        });
      })
      .catch(console.error);

    function buildFilters() {
      const countries = uniqSorted(wines.map(w => w.Country));
      const varietals = uniqSorted(wines.map(w => w.Varietal));
      const cSel = document.getElementById('filter-country');
      countries.forEach(c => cSel.add(new Option(c, c)));
      const vSel = document.getElementById('filter-varietal');
      varietals.forEach(v => vSel.add(new Option(v, v)));
    }

    function buildNav() {
      const nav = document.getElementById('nav-list');
      uniqSorted(wines.map(w => w.Type)).forEach(type => {
        const li = document.createElement('li');
        const a  = document.createElement('a');
        a.href = `#type-${type.replace(/\s+/g,'-')}`;
        a.textContent = type;
        a.style.color = '#777';
        li.appendChild(a);
        nav.appendChild(li);
      });
    }

    function renderList() {
      const container = document.getElementById('wine-list');
      container.innerHTML = '';
      const term = document.getElementById('search').value.toLowerCase();
      const countryFilter = document.getElementById('filter-country').value;
      const varietalFilter = document.getElementById('filter-varietal').value;
      const filtered = wines.filter(w => {
        const entry = `${w.Wine}, ${w.Appellation}, ${w.Vintage}`.toLowerCase();
        return (!term || entry.includes(term))
            && (countryFilter === 'All' || w.Country === countryFilter)
            && (varietalFilter === 'All' || w.Varietal === varietalFilter);
      });
      const grouped = {};
      filtered.forEach(w => {
        grouped[w.Type] = grouped[w.Type] || {};
        grouped[w.Type][w.Country] = grouped[w.Type][w.Country] || {};
        grouped[w.Type][w.Country][w.Varietal] = grouped[w.Type][w.Country][w.Varietal] || [];
        grouped[w.Type][w.Country][w.Varietal].push(w);
      });
      Object.keys(grouped).forEach(type => {
        const sec = document.createElement('section');
        sec.id = `type-${type.replace(/\s+/g,'-')}`;
        const h2 = document.createElement('h2');
        h2.textContent = type;
        sec.appendChild(h2);
        Object.keys(grouped[type]).forEach(country => {
          const h3 = document.createElement('h3');
          h3.textContent = country;
          sec.appendChild(h3);
          Object.keys(grouped[type][country]).forEach(varietal => {
            const h4 = document.createElement('h4');
            h4.textContent = varietal;
            sec.appendChild(h4);
            const ul = document.createElement('ul'); ul.className = 'wine-list';
            grouped[type][country][varietal].forEach(w => {
              const li = document.createElement('li');
              li.textContent = `${w.Wine}, ${w.Appellation}, ${w.Vintage}`;
              ul.appendChild(li);
            });
            sec.appendChild(ul);
          });
        });
        container.appendChild(sec);
      });
    }
  </script>
</body>
</html>